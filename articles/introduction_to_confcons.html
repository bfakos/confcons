<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to package 'confcons' • confcons</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to package 'confcons'">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">confcons</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction_to_confcons.html">Introduction to package 'confcons'</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bfakos/confcons/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to package 'confcons'</h1>
                        <h4 data-toc-skip class="author">Ákos
Bede-Fazekas, Imelda Somodi</h4>
            
            <h4 data-toc-skip class="date">2025-08-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bfakos/confcons/blob/master/vignettes/introduction_to_confcons.Rmd" class="external-link"><code>vignettes/introduction_to_confcons.Rmd</code></a></small>
      <div class="d-none name"><code>introduction_to_confcons.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="confidence-and-consistency-what-are-they-and-why-using-them">Confidence and consistency: what are they and why using them?<a class="anchor" aria-label="anchor" href="#confidence-and-consistency-what-are-they-and-why-using-them"></a>
</h2>
<p>‘confcons’ (<strong>conf</strong>idence &amp;
<strong>cons</strong>istency) is a light-weight, stand-alone R package
designed to calculate the following two novel measures of
predictive/potential distribution models (incl. species distribution
models):</p>
<ul>
<li>
<em>confidence</em> that measures the proportion of predictions that
the model is confident in;</li>
<li>
<em>consistency</em> that measures how consistent the model is if
the confidence in the training and evaluation subsets are compared.</li>
</ul>
<p>While <em>confidence</em> serves as a replacement for the widely
criticized goodness-of-fit measures, such as AUC, <em>consistency</em>
is a proxy for model’s transferability (in space and time). Both
measures can be calculated</p>
<ul>
<li>in a balanced way, when predicted presences and predicted absences
are equally important. These measures are called <em>confidence in
predictions</em> (‘CP’) and <em>consistency of</em> (or difference in
confidences in) <em>predictions</em> (‘DCP’);</li>
<li>in a way weighted towards the predicted presences, when certain
positive presences are more important for the selected modelling
purpose. These measures are called <em>confidence in positive
predictions</em> (‘CPP’) and <em>consistency of</em> (or difference in
confidences in) <em>positive predictions</em> (‘DCPP’).</li>
</ul>
<p>Much more information about the measures can be read in this
scientific paper:</p>
<p>Somodi I, Bede-Fazekas Á, Botta-Dukát Z, Molnár Z (2024):
<em>Confidence and consistency in discrimination: A new family of
evaluation metrics for potential distribution models</em>. Ecological
Modelling 491: 110667. DOI: <a href="https://doi.org/10.1016/j.ecolmodel.2024.110667" class="external-link">10.1016/j.ecolmodel.2024.110667</a>.</p>
</div>
<div class="section level2">
<h2 id="functions-for-calculating-confidence-and-consistency">Functions for calculating confidence and consistency<a class="anchor" aria-label="anchor" href="#functions-for-calculating-confidence-and-consistency"></a>
</h2>
<p>Three small functions, <code><a href="../reference/thresholds.html">thresholds()</a></code>,
<code><a href="../reference/confidence.html">confidence()</a></code> and <code><a href="../reference/consistency.html">consistency()</a></code>, belong to the
core of the package. A wrapper function called <code><a href="../reference/measures.html">measures()</a></code>
utilizes these workhorse functions and calculates every measures for us
optionally along with some traditional measures, such as AUC and
maxTSS.</p>
<p>In the example below we’ll see how these function work and what are
their parameters and returned value. For further details, please consult
with the help page of the selected function and the examples given
there.</p>
<p>Also, in the last section, we’ll see how multiple models can be
evaluated in a <code>for</code> loop, <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code>, or the
package ‘ENMeval’.</p>
</div>
<div class="section level2">
<h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>Here, we’ll go through the main steps of a typical workflow by:</p>
<ul>
<li>loading some environmental and presence-absence data using the
example dataset of package ‘blockCV’;</li>
<li>splitting the dataset to training and evaluation subset using
spatial blocks;</li>
<li>training some simple models on the training subset;</li>
<li>making predictions to the whole dataset;</li>
<li>evaluating our models; and</li>
<li>interpreting the measures.</li>
</ul>
<p>First, we install package ‘confcons’ and their dependencies needed
for this tutorial (incl. ‘terra’, ‘sf’, ‘blockCV’, ‘ranger’ and
‘ROCR’):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"confcons"</span>, dependencies <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>If installed, we can attach these packages to the R session (and
suppress the not too important warnings about the R version under the
packages were built):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.8.60</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rvalavi/blockCV" class="external-link">blockCV</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; blockCV 3.2.0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://imbs-hl.github.io/ranger/" class="external-link">ranger</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://ipa-tys.github.io/ROCR/" class="external-link">ROCR</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.unil.ch/ecospat/home/menuguid/ecospat-resources/tools.html" class="external-link">ecospat</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jamiemkass.github.io/ENMeval/" class="external-link">ENMeval</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; This is ENMeval version 2.0.5.2. </span></span>
<span><span class="co">#&gt; For worked examples, please consult the vignette: &lt;https://jamiemkass.github.io/ENMeval/articles/ENMeval-2.0-vignette.html&gt;.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bfakos/confcons" class="external-link">confcons</a></span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h3>
<p>Let’s open the environmental raster that contains four climatic
layers at 5’ resolution in GDA2020 (Geocentric Datum of Australia)
projection:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">environment</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/au/"</span>, package <span class="op">=</span> <span class="st">"blockCV"</span><span class="op">)</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">environment</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="op">(</span><span class="va">predictors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">environment</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "bio_12" "bio_15" "bio_4"  "bio_5"</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">environment</span>, describe <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">name</span></span>
<span><span class="co">#&gt; [1] "GDA2020 / GA LCC"</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">environment</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8558.341 8558.341</span></span></code></pre></div>
<p>We open also the occurrence data from a .csv file and convert them to
Simple Features:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">occurrences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/"</span>, <span class="st">"species.csv"</span>, package <span class="op">=</span> <span class="st">"blockCV"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">occurrences</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">occurrences</span>,</span>
<span>                            coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>,</span>
<span>                            crs <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">environment</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For further details on the dataset, please refer to the vignette of
package <code>blockCV</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span><span class="st">"tutorial_1"</span><span class="op">)</span></span></code></pre></div>
<p>Now we split the study region to training and evaluation parts using
random spatial blocks and convert the resulted blocks to Simple
Features:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">blocks</span> <span class="op">&lt;-</span> <span class="fu">blockCV</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/blockCV/man/cv_spatial.html" class="external-link">cv_spatial</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">occurrences</span>,</span>
<span>                              column <span class="op">=</span> <span class="st">"occ"</span>,</span>
<span>                              r <span class="op">=</span> <span class="va">environment</span>,</span>
<span>                              size <span class="op">=</span> <span class="fl">350000</span>,</span>
<span>                              k <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                              selection <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>                              iteration <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                              seed <span class="op">=</span> <span class="fl">12345</span>,</span>
<span>                              progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                              report <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                              plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_to_confcons_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">blocks_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">blocks</span><span class="op">$</span><span class="va">blocks</span><span class="op">)</span></span></code></pre></div>
<p>Let’s see where are our presence and absence points and also which
polygons will be used for training and which ones for evaluation:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">environment</span><span class="op">[[</span><span class="st">"bio_5"</span><span class="op">]</span><span class="op">]</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lightskyblue2"</span>, <span class="st">"lightyellow1"</span>, <span class="st">"rosybrown2"</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="fl">255</span><span class="op">)</span>, colNA <span class="op">=</span> <span class="st">"gray95"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">occurrences</span><span class="op">[</span><span class="va">occurrences</span><span class="op">$</span><span class="va">occ</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span>, pch <span class="op">=</span> <span class="st">"+"</span>, col <span class="op">=</span> <span class="st">"darkgreen"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">occurrences</span><span class="op">[</span><span class="va">occurrences</span><span class="op">$</span><span class="va">occ</span> <span class="op">==</span> <span class="fl">0</span>, <span class="op">]</span>, pch <span class="op">=</span> <span class="st">"+"</span>, col <span class="op">=</span> <span class="st">"orange"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">blocks_sf</span><span class="op">[</span><span class="va">blocks_sf</span><span class="op">$</span><span class="va">folds</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"transparent"</span>, border <span class="op">=</span> <span class="st">"royalblue1"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">blocks_sf</span><span class="op">[</span><span class="va">blocks_sf</span><span class="op">$</span><span class="va">folds</span> <span class="op">==</span> <span class="fl">2</span>, <span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"transparent"</span>, border <span class="op">=</span> <span class="st">"palevioletred1"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">2100000</span>,</span>
<span>       y <span class="op">=</span> <span class="op">-</span><span class="fl">1300000</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"presence"</span>, <span class="st">"absence"</span>, <span class="st">"training"</span>, <span class="st">"evaluation"</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkgreen"</span>, <span class="st">"orange"</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>       pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="st">"+"</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>       border <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">"royalblue1"</span>, <span class="st">"palevioletred1"</span><span class="op">)</span>,</span>
<span>       fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">"transparent"</span>, <span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_to_confcons_files/figure-html/unnamed-chunk-9-1.png" width="960"></p>
<p>We start to build a <code>data.frame</code> that will contain</p>
<ul>
<li>coordinates (longitude and latitude) of the presence and absence
locations,</li>
<li>the predictor values in the presence and absence locations,</li>
<li>the observed occurrences (i.e. 1 or 0),</li>
<li>the training mask (<code>TRUE</code> for the location later used for
model training, <code>FALSE</code> for evaluation locations), and</li>
<li>the predicted probabilities of occurrence (later appended).</li>
</ul>
<p><code><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">sf::st_coordinates()</a></code> provides the coordinates and
<code><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">raster::extract()</a></code> gathers the predictors from the studied
locations for us. <code>blocks$folds[[1]]</code> contains two vectors of
indices. We’ll use the first vector for training (and the second one for
evaluation).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coordinates</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">occurrences</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">coordinates</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span></span>
<span><span class="va">dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">coordinates</span>,</span>
<span>                 <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">environment</span>,</span>
<span>                                              y <span class="op">=</span> <span class="va">occurrences</span>,</span>
<span>                                              ID <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dataset</span><span class="op">$</span><span class="va">occurrences</span> <span class="op">&lt;-</span> <span class="va">occurrences</span><span class="op">$</span><span class="va">occ</span></span>
<span><span class="va">dataset</span><span class="op">$</span><span class="va">training_mask</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">occurrences</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="va">blocks</span><span class="op">$</span><span class="va">folds_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    500 obs. of  8 variables:</span></span>
<span><span class="co">#&gt;  $ longitude    : num  1313728 1176795 -1741599 1099770 1279495 ...</span></span>
<span><span class="co">#&gt;  $ latitude     : num  -2275453 -1916003 -3927213 -4124055 -3901538 ...</span></span>
<span><span class="co">#&gt;  $ bio_12       : num  1287 1115 959 610 553 ...</span></span>
<span><span class="co">#&gt;  $ bio_15       : num  93.8 118.6 85.1 22.8 15.4 ...</span></span>
<span><span class="co">#&gt;  $ bio_4        : num  324 241 347 559 585 ...</span></span>
<span><span class="co">#&gt;  $ bio_5        : num  31.2 29.4 28 31 31.4 ...</span></span>
<span><span class="co">#&gt;  $ occurrences  : int  0 0 1 1 0 0 0 0 1 0 ...</span></span>
<span><span class="co">#&gt;  $ training_mask: logi  TRUE TRUE FALSE FALSE TRUE TRUE ...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="training-models-and-making-predictions">Training models and making predictions<a class="anchor" aria-label="anchor" href="#training-models-and-making-predictions"></a>
</h3>
<p>Now the <code>data.frame</code> contains all of the information
needed to train predictive distribution models. For the sake of this
example, we will create two simple models:</p>
<ul>
<li>a Generalized Linear Model (GLM) with a linear formula (i.e.,
without interactions) and stepwise predictor selection, and</li>
<li>a Random Forest (RF) model with 10000, 8-level trees (the parameters
were deliberately set to obtain an overfitted model).</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">linear_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"occurrences ~ "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">predictors</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">model_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html" class="external-link">step</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                  object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">linear_formula</span>,</span>
<span>                               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>                               data <span class="op">=</span> <span class="va">dataset</span><span class="op">[</span><span class="va">dataset</span><span class="op">$</span><span class="va">training_mask</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dataset</span><span class="op">$</span><span class="va">predictions_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">model_glm</span>,</span>
<span>                                   newdata <span class="op">=</span> <span class="va">dataset</span>,</span>
<span>                                   type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<p>The GLM model was trained on the training subset
(<code>dataset[dataset$training_mask, ]</code>) but all of the studied
locations were used for prediction (i.e. training and evaluation
subsets). A new column called ‘predictions_glm’ was appended to the
<code>data.frame</code>. We repeat the same procedure, now training the
RF model:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_rf</span> <span class="op">&lt;-</span> <span class="fu">ranger</span><span class="fu">::</span><span class="fu"><a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">linear_formula</span>,</span>
<span>                           data <span class="op">=</span> <span class="va">dataset</span><span class="op">[</span><span class="va">dataset</span><span class="op">$</span><span class="va">training_mask</span>, <span class="op">]</span>,</span>
<span>                           num.trees <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>                           min.node.size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                           max.depth <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                           seed <span class="op">=</span> <span class="fl">12345</span>,</span>
<span>                           verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                           classification <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">dataset</span><span class="op">$</span><span class="va">predictions_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">predict</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">model_rf</span>,</span>
<span>                                  data <span class="op">=</span> <span class="va">dataset</span>,</span>
<span>                                  type <span class="op">=</span> <span class="st">"response"</span>,</span>
<span>                                  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">predictions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"occurrences"</span>, <span class="st">"training_mask"</span>, <span class="st">"predictions_glm"</span>, <span class="st">"predictions_rf"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    500 obs. of  4 variables:</span></span>
<span><span class="co">#&gt;  $ occurrences    : int  0 0 1 1 0 0 0 0 1 0 ...</span></span>
<span><span class="co">#&gt;  $ training_mask  : logi  TRUE TRUE FALSE FALSE TRUE TRUE ...</span></span>
<span><span class="co">#&gt;  $ predictions_glm: num  0.444 0.309 0.424 0.32 0.297 ...</span></span>
<span><span class="co">#&gt;  $ predictions_rf : num  0.059859 0.334737 0.875771 0.00106 0.000338 ...</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="evaluation-and-interpretation">Evaluation and interpretation<a class="anchor" aria-label="anchor" href="#evaluation-and-interpretation"></a>
</h3>
<p>Models are trained, predictions are done, so one step is missing: the
evaluation. This is where package ‘confcons’ will become useful…</p>
<p>Let’s take a look at the lower (mean predicted value in the absence
locations) and upper (mean predicted value in the presence locations)
thresholds below/above which we interpret the predicted values as
certain negatives and certain positives, respectively. We use function
<code><a href="../reference/thresholds.html">thresholds()</a></code> for this purpose, which needs the
integer/logical vector of the observed predictions (called
‘observations’) and the numeric vector of the predicted probabilities of
occurrence (called ‘predictions’) as input parameters. The function
returns two values (i.e., a named numeric vector of length 2).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">thresholds_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/thresholds.html">thresholds</a></span><span class="op">(</span>observations <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">occurrences</span>,</span>
<span>                              predictions <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">predictions_glm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; threshold1 threshold2 </span></span>
<span><span class="co">#&gt;  0.2958127  0.6034773</span></span>
<span><span class="op">(</span><span class="va">thresholds_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/thresholds.html">thresholds</a></span><span class="op">(</span>observations <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">occurrences</span>,</span>
<span>                             predictions <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">predictions_rf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; threshold1 threshold2 </span></span>
<span><span class="co">#&gt;  0.1312359  0.7452445</span></span></code></pre></div>
<p>Between 0.30 and 0.60, the predictions of the GLM model can be
treated as uncertain predictions. The same holds for the RF model
between 0.13 and 0.75.</p>
<p>Now we calculate two of the proposed evaluation measures, confidence
in positive predictions (CPP) and confidence in predictions (CP). Both
should be calculated using the evaluation subset. Function
<code><a href="../reference/confidence.html">confidence()</a></code> can calculate any of these measures, depending
on the value of its parameter ‘type’. If it’s ‘positive’, we’ll get CPP,
if it’s ‘neutral’, we’ll get CP that is not weighted towards the
positive predictions. Beyond ‘type’ and the two previously mentioned
parameters (‘observations’ and ‘predictions’) one more parameter is
needed: ‘thresholds’. Of course, the previously calculated thresholds
will perfectly suit for this purpose.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conf_P_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/confidence.html">confidence</a></span><span class="op">(</span>observations <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">occurrences</span><span class="op">[</span><span class="op">!</span><span class="va">dataset</span><span class="op">$</span><span class="va">training_mask</span><span class="op">]</span>,</span>
<span>                          predictions <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">predictions_glm</span><span class="op">[</span><span class="op">!</span><span class="va">dataset</span><span class="op">$</span><span class="va">training_mask</span><span class="op">]</span>,</span>
<span>                          thresholds <span class="op">=</span> <span class="va">thresholds_glm</span>,</span>
<span>                          type <span class="op">=</span> <span class="st">"positive"</span><span class="op">)</span></span>
<span><span class="va">conf_P_eval</span></span>
<span><span class="co">#&gt; [1] 0.49</span></span>
<span><span class="va">conf_N_eval</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/confidence.html">confidence</a></span><span class="op">(</span>observations <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">occurrences</span><span class="op">[</span><span class="op">!</span><span class="va">dataset</span><span class="op">$</span><span class="va">training_mask</span><span class="op">]</span>,</span>
<span>                          predictions <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">predictions_glm</span><span class="op">[</span><span class="op">!</span><span class="va">dataset</span><span class="op">$</span><span class="va">training_mask</span><span class="op">]</span>,</span>
<span>                          thresholds <span class="op">=</span> <span class="va">thresholds_glm</span>,</span>
<span>                          type <span class="op">=</span> <span class="st">"neutral"</span><span class="op">)</span></span>
<span><span class="va">conf_N_eval</span></span>
<span><span class="co">#&gt; [1] 0.575</span></span></code></pre></div>
<p>There is not so much difference between the two measures. Whether we
should use CPP or CP for describing the confidence of our model depends
on the main aim of our model. Confidence should be between
<code>0</code> and <code>1</code>; the higher value indicates more
confidence. Our GLM is not super confident, since both CPP and CP are
relatively far from <code>1</code>.</p>
<p>We are a bit curious whether the confidence of the model is higher or
lower if is calculated for the training subset.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conf_P_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/confidence.html">confidence</a></span><span class="op">(</span>observations <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">occurrences</span><span class="op">[</span><span class="va">dataset</span><span class="op">$</span><span class="va">training_mask</span><span class="op">]</span>,</span>
<span>                           predictions <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">predictions_glm</span><span class="op">[</span><span class="va">dataset</span><span class="op">$</span><span class="va">training_mask</span><span class="op">]</span>,</span>
<span>                           thresholds <span class="op">=</span> <span class="va">thresholds_glm</span>,</span>
<span>                           type <span class="op">=</span> <span class="st">"positive"</span><span class="op">)</span></span>
<span><span class="va">conf_P_train</span></span>
<span><span class="co">#&gt; [1] 0.6803279</span></span>
<span><span class="va">conf_P_eval</span> <span class="op">&lt;</span> <span class="va">conf_P_train</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Of course, the model is more confident in the training subset than in
the evaluation subset. This is absolutely normal (and would be strange
if the opposite occurs). Which is not evident is the difference between
the two and its interpretation. <code><a href="../reference/consistency.html">consistency()</a></code> is the
function that does the magic for us: a simple subtraction… It needs one
of the two confidence measures (CPP or CP) for the training and the
evaluation dataset, and returns their difference.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/consistency.html">consistency</a></span><span class="op">(</span>conf_train <span class="op">=</span> <span class="va">conf_P_train</span>, conf_eval <span class="op">=</span> <span class="va">conf_P_eval</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.1903279</span></span></code></pre></div>
<p>A negative value between <code>-1</code> and <code>0</code> is
normal. The higher the consistency is (i.e., the closer to
<code>0</code>), the more consistent the model is. Positive value might
be an artifact or indicates that the training and evaluation subsets
were accidentally swapped.</p>
<p>We have got familiar with the three core functions of the package:
<code><a href="../reference/thresholds.html">thresholds()</a></code>, <code><a href="../reference/confidence.html">confidence()</a></code> and
<code><a href="../reference/consistency.html">consistency()</a></code>. The question is right if we ask: <em>why
should we call three different functions several times if we want to get
all the measures for our model?</em>. Well, we don’t have to. There is a
wrapper function called <code><a href="../reference/measures.html">measures()</a></code> that calculates
everything for us.</p>
<p>It needs three vectors:</p>
<ul>
<li>the <code>integer</code>/<code>logical</code> vector of observed
occurrences (‘observations’),</li>
<li>the <code>numeric</code> vector of predicted probabilities of
occurrence (‘predictions’), and</li>
<li>the <code>logical</code> mask of the evaluation locations
(‘evaluation_mask’).</li>
</ul>
<p>Previously we calculated the mask of the training locations, so its
negation (<code>!</code>) will perfectly match this purpose:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/measures.html">measures</a></span><span class="op">(</span>observations <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">occurrences</span>,</span>
<span>         predictions <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">predictions_glm</span>,</span>
<span>         evaluation_mask <span class="op">=</span> <span class="op">!</span><span class="va">dataset</span><span class="op">$</span><span class="va">training_mask</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CP_train    CP_eval        DCP  CPP_train   CPP_eval       DCPP </span></span>
<span><span class="co">#&gt;  0.6829268  0.5750000 -0.1079268  0.6803279  0.4900000 -0.1903279</span></span>
<span><span class="fu"><a href="../reference/measures.html">measures</a></span><span class="op">(</span>observations <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">occurrences</span>,</span>
<span>         predictions <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">predictions_rf</span>,</span>
<span>         evaluation_mask <span class="op">=</span> <span class="op">!</span><span class="va">dataset</span><span class="op">$</span><span class="va">training_mask</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CP_train    CP_eval        DCP  CPP_train   CPP_eval       DCPP </span></span>
<span><span class="co">#&gt;  0.8373984  0.5833333 -0.2540650  0.8373984  0.4680851 -0.3693133</span></span></code></pre></div>
<p>The result is a named <code>numeric</code> vector containing all of
the measures. It is more than needed. It is recommended to use
‘CPP_eval’ + ‘DCPP’, or, if predicted absences are as important as
predicted presences in our research, ‘CP_eval’ + ‘DCP’.</p>
<p>We can see that RF model is really confident (0.84) in its
predictions if the training subset is studied, but this confidence
sharply drops when switching to the evaluation subset (to 0.47). Hence,
the RF model is not too consistent, which warns us that transferability
issues might potentially occurs if used for extrapolation. The GLM model
is much more consistent (-0.19 vs. -0.37), so we should select that one
for extrapolation, e.g. in a climate change impact study.</p>
<p>If we have installed package ‘ROCR’, <code><a href="../reference/measures.html">measures()</a></code> can
provide the Area Under the ROC Curve (AUC) and the maximum of True Skill
Statistic (maxTSS) for us. We should simply switch the parameter
‘goodness’ from its default value (<code>FALSE</code>) to
<code>TRUE</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/measures.html">measures</a></span><span class="op">(</span>observations <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">occurrences</span>,</span>
<span>         predictions <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">predictions_glm</span>,</span>
<span>         evaluation_mask <span class="op">=</span> <span class="op">!</span><span class="va">dataset</span><span class="op">$</span><span class="va">training_mask</span>,</span>
<span>         goodness <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;   CP_train    CP_eval        DCP  CPP_train   CPP_eval       DCPP        AUC </span></span>
<span><span class="co">#&gt;  0.6829268  0.5750000 -0.1079268  0.6803279  0.4900000 -0.1903279  0.8403944 </span></span>
<span><span class="co">#&gt;     maxTSS </span></span>
<span><span class="co">#&gt;  0.5696565</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="evaluating-multiple-models">Evaluating multiple models<a class="anchor" aria-label="anchor" href="#evaluating-multiple-models"></a>
</h3>
<p>There is one another <code>logical</code> parameter, called ‘df’, by
which we can decide whether a one-row <code>data.frame</code> is more
suited for our analysis purposes.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/measures.html">measures</a></span><span class="op">(</span>observations <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">occurrences</span>,</span>
<span>         predictions <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">predictions_rf</span>,</span>
<span>         evaluation_mask <span class="op">=</span> <span class="op">!</span><span class="va">dataset</span><span class="op">$</span><span class="va">training_mask</span>,</span>
<span>         goodness <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         df <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;    CP_train   CP_eval       DCP CPP_train  CPP_eval       DCPP       AUC</span></span>
<span><span class="co">#&gt; 1 0.8373984 0.5833333 -0.254065 0.8373984 0.4680851 -0.3693133 0.8131043</span></span>
<span><span class="co">#&gt;      maxTSS</span></span>
<span><span class="co">#&gt; 1 0.5577608</span></span></code></pre></div>
<p>For example, if we have several models (i.e., two in this example),
we can simply <code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind()</a></code> these rows in a <code>for</code> loop
or a <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_IDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm"</span>, <span class="st">"rf"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">model_ID</span> <span class="kw">in</span> <span class="va">model_IDs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">column_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"predictions_"</span>, <span class="va">model_ID</span><span class="op">)</span></span>
<span>  <span class="va">conf_and_cons</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/measures.html">measures</a></span><span class="op">(</span>observations <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">occurrences</span>,</span>
<span>                            predictions <span class="op">=</span> <span class="va">dataset</span><span class="op">[</span>, <span class="va">column_name</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span>,</span>
<span>                            evaluation_mask <span class="op">=</span> <span class="op">!</span><span class="va">dataset</span><span class="op">$</span><span class="va">training_mask</span>,</span>
<span>                            df <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">model_ID</span> <span class="op">==</span> <span class="va">model_IDs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">conf_and_cons_df</span> <span class="op">&lt;-</span> <span class="va">conf_and_cons</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">conf_and_cons_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">conf_and_cons_df</span>, <span class="va">conf_and_cons</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">conf_and_cons_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">model_IDs</span></span>
<span><span class="va">conf_and_cons_df</span></span>
<span><span class="co">#&gt;      CP_train   CP_eval        DCP CPP_train  CPP_eval       DCPP</span></span>
<span><span class="co">#&gt; glm 0.6829268 0.5750000 -0.1079268 0.6803279 0.4900000 -0.1903279</span></span>
<span><span class="co">#&gt; rf  0.8373984 0.5833333 -0.2540650 0.8373984 0.4680851 -0.3693133</span></span></code></pre></div>
<p>The <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code> solution:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">conf_and_cons_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">model_IDs</span>,</span>
<span>                             FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">model_ID</span><span class="op">)</span> <span class="op">{</span></span>
<span>                               <span class="va">column_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"predictions_"</span>, <span class="va">model_ID</span><span class="op">)</span></span>
<span>                               <span class="fu"><a href="../reference/measures.html">measures</a></span><span class="op">(</span>observations <span class="op">=</span> <span class="va">dataset</span><span class="op">$</span><span class="va">occurrences</span>,</span>
<span>                                        predictions <span class="op">=</span> <span class="va">dataset</span><span class="op">[</span>, <span class="va">column_name</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span>,</span>
<span>                                        evaluation_mask <span class="op">=</span> <span class="op">!</span><span class="va">dataset</span><span class="op">$</span><span class="va">training_mask</span>,</span>
<span>                                        df <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>                             <span class="op">}</span><span class="op">)</span></span>
<span><span class="va">conf_and_cons_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span>what <span class="op">=</span> <span class="va">rbind</span>,</span>
<span>                            args <span class="op">=</span> <span class="va">conf_and_cons_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">conf_and_cons_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">model_IDs</span></span>
<span><span class="va">conf_and_cons_df</span></span>
<span><span class="co">#&gt;      CP_train   CP_eval        DCP CPP_train  CPP_eval       DCPP</span></span>
<span><span class="co">#&gt; glm 0.6829268 0.5750000 -0.1079268 0.6803279 0.4900000 -0.1903279</span></span>
<span><span class="co">#&gt; rf  0.8373984 0.5833333 -0.2540650 0.8373984 0.4680851 -0.3693133</span></span></code></pre></div>
<p>One may want to evaluate several MaxEnt models (e.g. during the
hyperparameter tuning) using several goodness-of-fit and transferability
measures. In this case, we recommend using function
<code><a href="https://jamiemkass.github.io/ENMeval/reference/ENMevaluate.html" class="external-link">ENMevaluate()</a></code> from package <code>ENMeval</code>. It
calculates AUC and the continuous Boyce index (CBI) automatically, but
the list of the calculated measures can be complemented with any
user-defined measures. For this, first, we define a function that
calculates <em>confidence in positive predictions</em> and
<em>consistency of positive predictions</em> from the argument
<code><a href="https://jamiemkass.github.io/ENMeval/reference/ENMevaluate.html" class="external-link">ENMevaluate()</a></code> provides to the user-defined functions.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calculate_conf_and_cons</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">vars</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1L</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">occs.train.pred</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0L</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">bg.train.pred</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1L</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">occs.val.pred</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0L</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">bg.val.pred</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">occs.train.pred</span>, <span class="va">vars</span><span class="op">$</span><span class="va">bg.train.pred</span>, <span class="va">vars</span><span class="op">$</span><span class="va">occs.val.pred</span>, <span class="va">vars</span><span class="op">$</span><span class="va">bg.val.pred</span><span class="op">)</span></span>
<span>  <span class="va">evaluation_mask</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">FALSE</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">occs.train.pred</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">bg.train.pred</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="cn">TRUE</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">occs.val.pred</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">bg.val.pred</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">measures</span> <span class="op">&lt;-</span> <span class="fu">confcons</span><span class="fu">::</span><span class="fu"><a href="../reference/measures.html">measures</a></span><span class="op">(</span>observations <span class="op">=</span> <span class="va">observations</span>, predictions <span class="op">=</span> <span class="va">predictions</span>, evaluation_mask <span class="op">=</span> <span class="va">evaluation_mask</span>, df <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CPP_eval"</span>, <span class="st">"DCPP"</span><span class="op">)</span><span class="op">]</span> <span class="co"># select two measures</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">measures</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"confidence"</span>, <span class="st">"consistency"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">measures</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now, we perform a hyperparameter tuning (with varying feature classes
and regularization multipliers) using spatial block cross-validation and
display the CBI, the confidence and the consistency for each feature
class × regularization multiplier combinations (averaged for the
cross-validation folds).</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hyperparameter_evaluation</span> <span class="op">&lt;-</span> <span class="fu">ENMeval</span><span class="fu">::</span><span class="fu"><a href="https://jamiemkass.github.io/ENMeval/reference/ENMevaluate.html" class="external-link">ENMevaluate</a></span><span class="op">(</span></span>
<span>  occs <span class="op">=</span> <span class="va">dataset</span><span class="op">[</span><span class="va">dataset</span><span class="op">$</span><span class="va">occurrences</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span>, <span class="va">predictors</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  bg <span class="op">=</span> <span class="va">dataset</span><span class="op">[</span><span class="va">dataset</span><span class="op">$</span><span class="va">occurrences</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span>, <span class="va">predictors</span><span class="op">)</span><span class="op">]</span>, </span>
<span>  tune.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"L"</span>, <span class="st">"LQ"</span>, <span class="st">"LQH"</span><span class="op">)</span>,</span>
<span>                   rm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.5</span>, to <span class="op">=</span> <span class="fl">1.5</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>, </span>
<span>  algorithm <span class="op">=</span> <span class="st">"maxnet"</span>,</span>
<span>  partitions <span class="op">=</span> <span class="st">"block"</span>,</span>
<span>  user.eval <span class="op">=</span> <span class="va">calculate_conf_and_cons</span>,</span>
<span>  updateProgress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">hyperparameter_evaluation</span><span class="op">@</span><span class="va">results</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fc"</span>, <span class="st">"rm"</span>, <span class="st">"cbi.val.avg"</span>, <span class="st">"confidence.avg"</span>, <span class="st">"consistency.avg"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;    fc  rm cbi.val.avg confidence.avg consistency.avg</span></span>
<span><span class="co">#&gt; 1   L 0.5     0.44900      0.5116402     -0.07994573</span></span>
<span><span class="co">#&gt; 2  LQ 0.5     0.94000      0.5892474     -0.06643251</span></span>
<span><span class="co">#&gt; 3 LQH 0.5     0.87450      0.6967532     -0.00937990</span></span>
<span><span class="co">#&gt; 4   L 1.0     0.48625      0.5182068     -0.07728052</span></span>
<span><span class="co">#&gt; 5  LQ 1.0     0.93325      0.6196672     -0.03829850</span></span>
<span><span class="co">#&gt; 6 LQH 1.0     0.91825      0.7610432      0.04924178</span></span>
<span><span class="co">#&gt; 7   L 1.5     0.50100      0.4966821     -0.10146804</span></span>
<span><span class="co">#&gt; 8  LQ 1.5     0.95125      0.5824163     -0.07255878</span></span>
<span><span class="co">#&gt; 9 LQH 1.5     0.89850      0.7334252      0.02739568</span></span></code></pre></div>
<p>According to the CBI values, the linear + quadratic features (LQ)
with regularization multiplier set to 1.5 seems to be the best
hyperparameter combination. However, confidence and consistency
disagrees with CBI. According to the confidence measure, the best
hyperparameter combinations are the LQH×1 and LQH×1.5 combinations, but
their consistencies are suspiciously high, i.e., greater than 0, which
suggests an artifact. Therefore we skip these combinations and find that
the model with linear + quadratic + hinge features (LQH) with
regularization multiplier set to 0.5 has the highest confidence and also
the highest (but negative) consistency, so we select this hyperparameter
combination for training the final MaxEnt model.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ákos Bede-Fazekas, Imelda Somodi.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
